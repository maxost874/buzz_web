<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Buzz Predictor â€” Live</title>
<script>
  /* â†â† ×¢×“×›×Ÿ ×›××Ÿ ×¨×§ ×©×ª×™ ×”×©×•×¨×•×ª â†“â†“â†“ */
  const API_BASE = "https://buzz-api-bbtg.onrender.com";      // ×›×ª×•×‘×ª ×”-API ×©×œ×š ×‘-Render
  const DASHBOARD_URL = "https://app.powerbi.com/groups/<workspace-id>/reports/<report-id>/ReportSection?pageName=<page-id>";
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  /* ×¦×‘×¢×™× */
  :root{
    --bg-outer:#bfe0b6;      /* ×¨×§×¢ ×™×¨×•×§ ×‘×”×™×¨ ××¡×‘×™×‘ */
    --panel:#f3fbf2;         /* ×¤× ×™× ×”×œ×•×— */
    --frame:#2e5d2e;         /* ××¡×’×¨×ª ×™×¨×•×§×” ×›×”×” */
    --headline:#0b6623;      /* ×¤×¡ ×›×•×ª×¨×ª ×›×”×” */
    --brand:#2F5597;
    --ok:#2E7D32; --bad:#C62828; --muted:#616161;
  }

  /* ×¨×§×¢ ××¡×š ×¢× â€œ×›×¨×™×ªâ€ */
  body{
    margin:0; padding:28px;
    background: radial-gradient(ellipse at center, var(--bg-outer) 0%, #cde9c7 100%);
    font-family: system-ui, -apple-system, Segoe UI, Roboto;
    color:#0f172a;
    display:flex; align-items:center; justify-content:center;
  }

  /* ×œ×•×— ××¨×›×–×™ + ××¡×’×¨×ª */
  .frame{
    width:min(1180px, 96vw);
    background:var(--bg-outer);
    border-radius:18px;
    box-shadow:0 16px 40px rgba(0,0,0,.18);
    padding:14px;
  }
  .panel{
    background:var(--panel);
    border:4px solid var(--frame);
    border-radius:14px;
    padding:18px 18px 26px;
  }

  /* ×¤×¡ ×›×•×ª×¨×ª */
  .header{
    position:relative;
    background:var(--headline);
    border:2px solid #0a0a0a;
    color:#fff;
    font-weight:800;
    font-size:clamp(20px, 2.6vw, 34px);
    text-align:center;
    padding:16px 60px;
    border-radius:6px;
  }
  .header .left, .header .right{
    position:absolute; top:50%; transform:translateY(-50%);
    width:42px; height:42px; object-fit:contain;
  }
  .header .left{ left:14px; }
  .header .right{ right:14px; }

  .subline{
    margin:14px 0 10px;
    padding-bottom:8px;
    border-bottom:4px solid var(--frame);
    color:#2f4f2f;
    text-align:center;
    font-size:16px;
  }

  /* ×ª×•×•×™×ª ×œ×©×“×” ×”×˜×§×¡×˜ â€“ ××™×•×©×¨ ×©×××œ×” */
  .post-label{
    display:block;
    margin:0 0 6px;
    text-align:left;
    direction:ltr;
    font-weight:700;
  }

  /* ×›×¨×˜×™×¡×™×, ×˜×§×¡×˜, ×›×¤×ª×•×¨×™× */
   .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr); /* ×‘×“×™×•×§ 4 ×¢××•×“×•×ª */
      gap: 20px;
  }


  .card{background:#fff; border-radius:12px; padding:18px; box-shadow:0 2px 10px rgba(0,0,0,.06)}

    /* ----- Metric Card (Accuracy) ----- */
  .metric-card{
    text-align:center;
    min-height:220px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:8px;
  }
  .metric-title{
    font-weight:800;
  }
  .metric-value{
    font-size:clamp(28px, 4vw, 44px);
    font-weight:900;
    color:#0f172a;
    padding:12px 20px;
    border-radius:14px;
    border:3px solid #2E7D32;
    background:#e8f5e9;
    box-shadow: inset 0 0 0 4px #d9f0dc;
  }
  .metric-sub{
    color:#475569;
    font-size:14px;
  }

  textarea {
    width: 100%;           /* ×™×ª×¤×•×¡ ××ª ×›×œ ×”×¨×•×—×‘ ×©×œ ×”×›×¨×˜×™×¡ */
    max-width: 100%;
    min-height: 120px;     /* ×’×•×‘×” ×”×ª×—×œ×ª×™ â€“ ×©×•×¨×” ×•×—×¦×™-×©×ª×™×™× */
    margin: 10px auto;
    display: block;
    box-sizing: border-box;
  
    /* ×›×ª×™×‘×” LTR */
    direction: ltr;
    text-align: left;
    unicode-bidi: plaintext;
  
    resize: vertical;      /* ××¤×©×¨×•×ª ×œ××©×ª××© ×œ×”×’×“×™×œ/×œ×”×§×˜×™×Ÿ ×¨×§ ×‘×’×•×‘×” */
  }


  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
  .btn,button{
    padding:10px 16px;border:0;border-radius:10px;background:var(--brand);color:#fff;
    font-weight:700;cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,.12)
  }
  .btn.ghost{background:#e2e8f0;color:#111}

  /* Back button */
  .back-btn{
    display:inline-flex; align-items:center; gap:8px; padding:10px 18px;
    background:#e9eef5; border-radius:10px; font-weight:800; color:#0f172a;
    text-decoration:none; box-shadow:0 2px 8px rgba(0,0,0,.12); transition:all .2s ease;
  }
  .back-btn:hover{ background:#dfe7f3; transform:translateY(-2px); }
  .back-btn .arrow{ line-height:1 }
  [dir="rtl"] .back-btn .arrow::before{ content:"\2190"; } /* â† */
  [dir="ltr"] .back-btn .arrow::before{ content:"\2192"; } /* â†’ */

  .pill{padding:6px 10px;border-radius:999px;font-weight:700;background:#eee}
  .pill.ok{color:var(--ok);background:#e8f5e9}
  .pill.bad{color:var(--bad);background:#fdecec}
  .pill.muted{color:var(--muted);background:#f3f4f6}

  /* KPI */
 
  /* KPI â€“ ×™×™×©×•×¨ × ×§×™: label ×‘×¦×“ ×™××™×Ÿ, value ××©×××œ */
  .kpi-card{
    display:grid;
    gap:16px;
    font-size:18px;
    padding:20px;
  }
  .kpi-row{
    display: grid;
    grid-template-columns: 1fr auto; /* ×§×•×“× ×›×•×ª×¨×ª (×©×××œ), ×•××– ×¢×¨×š (×™××™×Ÿ) */
    align-items: center;
    column-gap: 14px;
    direction: ltr;                 /* ×”×•×¤×š ××ª ×–×¨×™××ª ×”-grid ×œ×©×××œâ†’×™××™×Ÿ ×¨×§ ×‘×©×•×¨×” ×”×–×• */
  }
  .kpi-label{
    font-weight:800;
    color:#16351a;
    text-align: left;               /* ×”×›×•×ª×¨×ª ×œ×©×××œ */
  }

  .kpi-value{
    font-weight:700;
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: flex-end;      /* ×”×¢×¨×š â€œ× ×“×‘×§â€ ×œ×™××™×Ÿ ×”×©×•×¨×” */
    text-align: right;
    direction: ltr;
  }

    /* ×›×¨×˜×™×¡×™ ×’×¨×¤×™× ×§×‘×•×¢×™× ×‘×’×•×‘×” */
  .card.chart{
    min-height: 320px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  
  /* ×”×§× ×‘×¡×™× ×¢×¦×× â€“ ×¨×•×—×‘ ××œ× + ×’×•×‘×” ×§×‘×•×¢ */
  .card.chart canvas{
    display: block;
    width: 100% !important;
    height: 260px !important;  /* ×©× ×” ×œ-240/280 ×× ×ª×¨×¦×” */
  }



  /* Progress */
  .progress{ height:10px; background:#ecf2ec; border-radius:999px; overflow:hidden; }
  .progress-fill{ height:100%; width:0%; transition:width .4s ease; }
  .progress-fill.low{  background:#f7b6b6; }
  .progress-fill.med{  background:#ffd07a; }
  .progress-fill.high{ background:#9ad29b; }

  .pill.sm{ padding:4px 8px; font-weight:800; }

    /* ==== Compact dashboard overrides (fits your current markup) ==== */
  .grid{ gap:16px; }                                  /* ×”×™×” 20px */
  
  #results .card{ padding:14px; }                     /* ×”×™×” 18px */
  #results .kpi-card{ padding:14px; gap:10px; font-size:16px; }  /* ×”×™×” padding 20px */
  #results .kpi-row{ column-gap:10px; }
  
  #results .metric-card{ min-height:150px; }          /* ×”×™×” 220px */
  #results .metric-value{
    font-size:clamp(22px, 2.6vw, 32px);               /* ×”×™×” 28â€“44px */
    padding:8px 12px;
    border-width:2px;
  }
  
  #results .card.chart{ min-height:220px; }           /* ×”×™×” 320px */
  #results .card.chart canvas{ height:160px !important; } /* ×”×™×” 260px */
  
  #results .progress{ height:8px; }                   /* ×”×™×” 10px */
  #results .pill.sm{ padding:3px 6px; }               /* ×”×™×” 4px 8px */
  
  /* ×¨×¡×¤×•× ×¡×™×‘×™ × ×—××“ ×©×œ× ×™×©×‘×•×¨ ×‘××¡×›×™× ×¦×¨×™× */
  @media (max-width: 1024px){
    .grid{ grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width: 640px){
    .grid{ grid-template-columns: 1fr; }
  }

  /* ==== Scroll fix: top-align and allow vertical scrolling ==== */
html, body { height: auto; min-height: 100%; }  /* ×œ× "height:100%" ×§×©×™×— */
body{
  align-items: flex-start;   /* ×‘××§×•× center â€“ ×œ×™×™×©×¨ ×œ××¢×œ×” */
  min-height: 100vh;         /* ×œ×¤×—×•×ª ×’×•×‘×” ×—×œ×•×Ÿ */
  overflow-y: auto;          /* ××•×•×“× ×©×™×© ×’×œ×™×œ×” ×× ×›×™×ª */
}
/* ×§×¦×ª ××¨×•×•×— ××œ××¢×œ×”/×œ××˜×” ×©×™×”×™×” × ×¢×™× ×‘×’×œ×™×œ×” */
.frame{ margin-top: 12px; margin-bottom: 32px; }

  /* ==== AI section: force left/LTR ==== */
#improveSection{ direction:ltr; text-align:left; }
#improveSection h2,
#improveSection p{ text-align:left; }

/* ×ª×™×‘×•×ª ×”×ª×•×›×Ÿ ×¢×¦××Ÿ */
#aiTitle,
#aiTags,
#aiSuggestions,
#aiSuggestions > div{
  direction:ltr;
  text-align:left;
  unicode-bidi: plaintext;  /* ××•× ×¢ ×”×™×¤×•×š ×¡×™×× ×™ ×¤×™×¡×•×§ */
}
  
</style>
</head>
<body>

  <!-- ××¡×’×¨×ª ×™×¨×•×§×” ×—×™×¦×•× ×™×ª -->
  <div class="frame">
    <div class="panel">
      <!-- ×¤×¡ ×›×•×ª×¨×ª + ××™×™×§×•× ×™× -->
      <div class="header">
        <img class="left"  src="./reddit.png" alt="reddit">
        Buzz Predictor â€” Live
        <img class="right" src="./buzz.png"   alt="buzz">
      </div>
      <div class="subline">Fill in the details, analyze your content, and predict the buzz</div>

      <!-- ×˜×§×¡×˜ + ×›×¤×ª×•×¨×™× -->
      <div class="card" style="margin-top:10px">
        <label for="txt" class="post-label">Post Text</label>
        <textarea id="txt" placeholder="Example: This post will explode today!"></textarea>
        <div class="row" style="margin-top:10px">
          <a class="back-btn" id="back" href="#"><span>Back to Dashboard</span><i class="arrow"></i></a>
          <button id="go">Predict</button>
        </div>
      </div>

      <!-- ××–×•×¨ ×ª×•×¦××•×ª -->
      <div class="grid" id="results" style="display:none; margin-top:14px" aria-live="polite">
      
        <div class="card kpi-card">
          <div class="kpi-row">
            <div class="kpi-label">Prediction:</div>
            <div class="kpi-value">
              <span id="predPill" class="pill sm muted">â€“</span>
            </div>
          </div>
      
          <div class="kpi-row">
            <div class="kpi-label">Probability:</div>
            <div class="kpi-value"><span id="prob">â€“</span></div>
          </div>
          <div class="progress"><div id="probFill" class="progress-fill"></div></div>
      
          <div class="kpi-row">
            <div class="kpi-label">Sentiment:</div>
            <div class="kpi-value"><span id="sent" class="pill sm muted">â€“</span></div>
          </div>
        </div>
      
        <div class="card chart">
          <div><strong>Success Probability</strong></div>
          <canvas id="probChart"></canvas>
        </div>
      
        <div class="card chart">
          <div><strong>Sentiment Breakdown</strong></div>
          <canvas id="sentChart"></canvas>
        </div>
      
        <div class="card metric-card" id="accCard">
          <div class="metric-title">Model Accuracy</div>
          <div class="metric-value" id="accValue">70%</div>
        </div>
      
      </div> <!-- â† ×›××Ÿ × ×¡×’×¨ ×”-grid -->
      
      <!-- ===== AI Post Improver ===== -->
      <section id="improveSection" style="margin-top:24px;padding:16px;border:2px solid #2e5d2e;background:#f3fbf2;border-radius:16px">
        <h2 style="color:#0b6623;margin:0 0 8px">AI â€“ Post upgrade</h2>
        <p style="margin:0 0 12px">Click to get a suggested title, 3 improved versions, and hashtags based on the text above.</p>
        <button id="improveBtn" style="padding:10px 16px;border-radius:10px;border:1px solid #2e5d2e;background:#2e5d2e;color:#fff;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.12)">
          Upgrade my post âœ¨
        </button>
      
        <div id="improveArea" style="margin-top:14px;display:none">
          <h3 style="margin:10px 0 6px">Suggested title</h3>
          <div id="aiTitle" style="background:#fff;border:1px dashed #cfe3cf;padding:8px;border-radius:10px"></div>
      
          <h3 style="margin:14px 0 6px">Proposed versions</h3>
          <div id="aiSuggestions"></div>
      
          <h3 style="margin:14px 0 6px">#hashtags</h3>
          <div id="aiTags" style="background:#fff;border:1px dashed #cfe3cf;padding:8px;border-radius:10px"></div>
        </div>
      </section>
      
      </div> <!-- â† ×›××Ÿ × ×¡×’×¨×ª .panel -->
      </div>   <!-- â† ×›××Ÿ × ×¡×’×¨×ª .frame -->


<script>
/* ======= JS ======= */
let probChart, sentChart;
const $ = id => document.getElementById(id);
$("back").href = DASHBOARD_URL;

async function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }
async function wakeApi(maxTries=6){
  for(let i=1;i<=maxTries;i++){
    try{
      const r = await fetch(`${API_BASE}/health`, {method:"GET", mode:"cors"});
      if(r.ok) return true;
    }catch(e){}
    await sleep(i*1000);
  }
  return false;
}

/* ×¤×œ××’×™×Ÿ ×˜×§×¡×˜ ×‘××¨×›×– ×“×•× ××˜ â€” ×¢× ID ×™×™×—×•×“×™ ×›×“×™ ×œ×× ×•×¢ ×›×¤×™×œ×•×ª */
function centerTextPlugin(text, id = "centerText_" + Math.random().toString(36).slice(2)){
  return {
    id,
    afterDraw(chart){
      const {ctx, chartArea:{left, right, top, bottom}} = chart;
      ctx.save();
      ctx.font = "700 18px system-ui";
      ctx.fillStyle = "#0f172a";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(text, (left+right)/2, (top+bottom)/2);
      ctx.restore();
    }
  };
}

async function predict(){
  const t = $("txt").value.trim();
  if(!t){ alert("×”×›× ×¡ ×˜×§×¡×˜"); return; }

  const btn=$("go"); btn.disabled=true; btn.textContent="...Predicting";
  try{
    const ok = await wakeApi();
    if(!ok) throw new Error("API not responding (health).");

    // GET ×œ×œ× preflight (×¢×•×§×£ CORS)
    const r = await fetch(`${API_BASE}/predict_qs?text=${encodeURIComponent(t)}`, {
      method:"GET", mode:"cors"
    });
    if(!r.ok){
      const text = await r.text().catch(()=> "");
      throw new Error(`HTTP ${r.status} â€“ ${text || "Request failed"}`);
    }
    const d = await r.json();

    const isBuzz = Number(d.prediction)===1;

    // ×”×¡×ª×‘×¨×•×ª ×¢× clamp
    const pRaw = Number(d.probability);
    const p = Math.max(0, Math.min(1, isFinite(pRaw) ? pRaw : 0));

    // × ×¨××•×œ ×¡× ×˜×™×× ×˜
    const s = d.sentiment || {pos:0,neu:0,neg:0,compound:0};
    const sNorm = {
      pos: Math.max(0, Math.min(1, Number(s.pos) || 0)),
      neu: Math.max(0, Math.min(1, Number(s.neu) || 0)),
      neg: Math.max(0, Math.min(1, Number(s.neg) || 0)),
      compound: Number(s.compound) || 0
    };

    // Prediction
    $("predPill").textContent = isBuzz ? "Buzz High potential" : "Buzz Low potential";
    $("predPill").className = "pill sm " + (isBuzz ? "ok" : "bad");


    // Probability (×˜×§×¡×˜ + ×¤×¨×•×’×¨×¡ ×‘×¨)
    $("prob").textContent = (p*100).toFixed(2) + "%";
    const fill = $("probFill");
    fill.style.width = (p*100) + "%";
    fill.className = "progress-fill " + (p<0.33 ? "low" : p<0.66 ? "med" : "high");

    // Sentiment badge
    const top = Object.entries({Positive:sNorm.pos, Neutral:sNorm.neu, Negative:sNorm.neg})
      .sort((a,b)=>b[1]-a[1])[0][0];
    $("sent").textContent = top;
    $("sent").className = "pill sm " + (top==="Positive" ? "ok" : top==="Negative" ? "bad" : "muted");

    // â”€â”€ ×’×¨×¤×™× â”€â”€
    const ctx1=$("probChart").getContext("2d"); if(probChart) probChart.destroy();
    probChart = new Chart(ctx1, {
      type: "doughnut",
      data: {
        labels: ["Success", "Other"],
        datasets: [{ data: [p, 1 - p], backgroundColor: ["#22c55e", "#f87171"] }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,    // ×—×©×•×‘: ×©×™×ª××™× ×œ×’×•×‘×” ×”-CSS
        plugins: { legend: { display:false } },
        cutout: "70%",
        layout: { padding: 8 }         // ×§×¦×ª ××¨×•×•×— ×¤× ×™××™
      },
      plugins: [centerTextPlugin((p*100).toFixed(2) + "%")]
    });


    const ctx2=$("sentChart").getContext("2d"); if(sentChart) sentChart.destroy();
    sentChart = new Chart(ctx2, {
      type: "bar",
      data: {
        labels:["Positive","Neutral","Negative"],
        datasets:[{ data:[sNorm.pos, sNorm.neu, sNorm.neg] }]
      },
      options:{
        responsive: true,
        maintainAspectRatio: false,    // ×—×©×•×‘: ×©×™×ª××™× ×œ×’×•×‘×” ×”-CSS
        plugins:{ legend:{ display:false } },
        scales:{ y:{ min:0, max:1 } },
        layout: { padding: 8 }
      }
    });


const ACC = 0.70;
document.getElementById("accValue").textContent = `${(ACC*100).toFixed(0)}%`;


    $("results").style.display="grid";
  }catch(e){
    alert("Request failed: " + (e.message || e));
  }finally{
    btn.disabled=false; btn.textContent="Predict";
  }
}

$("go").onclick = predict;

// ===== AI Improver =====
async function improvePost() {
  const txt = $("txt").value.trim();
  if (!txt) { alert("××™×Ÿ ×˜×§×¡×˜ ×œ×©×“×¨×•×’"); return; }

  const btn = $("improveBtn");
  btn.disabled = true;
  const oldLabel = btn.textContent;
  btn.textContent = "Generates suggestionsâ€¦";

  try {
    // ğŸ”¥ ×—×™××•× ×”×©×¨×ª (×›××• ×‘-predict)
    const ok = await wakeApi();
    if (!ok) throw new Error("API not responding (health).");

    const res = await fetch(`${API_BASE}/improve`, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ text: txt })
    });
    const data = await res.json();

    if (!res.ok || !data.ok) {
      const msg = (data && (data.error || data.detail)) || `HTTP ${res.status}`;
      throw new Error(msg);
    }

    $("aiTitle").textContent = data.title || "";

    const wrap = $("aiSuggestions");
    wrap.innerHTML = "";
    (data.suggestions || []).forEach((s) => {
      const card = document.createElement("div");
      card.style.cssText =
        "border:1px solid #cfe3cf;background:#fff;padding:12px 14px;border-radius:12px;margin-bottom:10px;white-space:pre-wrap;text-align:left;direction:ltr;unicode-bidi:plaintext";
      card.textContent = s;
      wrap.appendChild(card);
    });

    $("aiTags").textContent = (data.hashtags || []).join(" ");
    $("improveArea").style.display = "block";
    console.log("Improve source:", data.source); // "hf" ××• "fallback"
  } catch (e) {
    alert("×©×’×™××” ×‘×™×¦×™×¨×ª ×”×”×¦×¢×•×ª: " + (e.message || e));
  } finally {
    btn.disabled = false;
    btn.textContent = oldLabel;
  }
}


document.getElementById("improveBtn").addEventListener("click", improvePost);
  
</script>
</body>
</html>


















